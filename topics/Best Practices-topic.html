<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="Best Practices topic docs, for the Dart programming language.">
  <title>Best Practices topic - Dart API</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="../static-assets/github.css?v1">
  <link rel="stylesheet" href="../static-assets/styles.css?v1">
  <link rel="icon" href="../static-assets/favicon.png?v1">

  
</head>


<body data-base-href="../" data-using-base-href="false" class="light-theme">

<div id="overlay-under-drawer"></div>

<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="../index.html">mansion</a></li>
    <li class="self-crumb">Best Practices topic</li>
  </ol>
  <div class="self-name">Best Practices</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <div class="toggle" id="theme-button" title="Toggle brightness">
    <label for="theme">
      <input type="checkbox" id="theme" value="light-theme">
      <span id="dark-theme-button" class="material-symbols-outlined">
        dark_mode
      </span>
      <span id="light-theme-button" class="material-symbols-outlined">
        light_mode
      </span>
    </label>
  </div>
</header>
<main>

<div id="dartdoc-main-content" class="main-content">
  <h1><span class="kind-category">Best Practices</span> topic</h1>
  
<section class="desc markdown">
  <p>Writing a comprehensive <em>best practices</em> guide for using ANSI is hard!</p>
<p>However, here are some general guidelines to follow when using ANSI escape
codes, when using <code>package:mansion</code>, and possible directions for future packages
that build on top of the library.</p>
<h2 id="avoid-intermediate-strings">Avoid intermediate strings</h2>
<p>When writing performance sensitive code, avoid converting ANSI escape codes to
strings, and instead either use <code>&lt;Sequence&gt;.writeAnsiString</code> or
<code>&lt;Sink&gt;.writeAnsi</code> directly. This will avoid the overhead of creating and
manipulating intermediate strings:</p>
<pre class="language-dart"><code class="language-dart">import 'dart:io';
import 'package:mansion/mansion.dart';

void main() {
  final sequence = Print('Hello, World!');
  stdout.writeAnsi(sequence);
}
</code></pre>
<h2 id="use-finally-when-shutting-down">Use <code>finally</code> when shutting down</h2>
<p>A <code>try { ... } finally { ... }</code> is equivalent to the <code>defer</code> keyword in Go,
or the <code>using</code> keyword in C#. It is a good way to ensure that cleanup code is
always run, even if an exception is thrown:</p>
<pre class="language-dart"><code class="language-dart">import 'dart:io';
import 'package:mansion/mansion.dart';

void main() {
  try {
    // ... write a bunch of colors and styles ...
  } finally {
    // avoid leaving the terminal in a weird state
    stdout.writeAnsi(SetStyles.reset);
  }
}
</code></pre>
<p>More specific advice is listed below.</p>
<h3 id="prefer-alternate-screen-for-full-screen-applications">Prefer alternate screen for full screen applications</h3>
<p>When starting an application that will make heavy use of ANSI escape codes, such
as an interactive terminal application, game, text editor, or anything that will
be effectively "full screen", prefer entering an alternate screen on startup:</p>
<pre class="language-dart"><code class="language-dart">import 'dart:io';
import 'package:mansion/mansion.dart';

void main() {
  stdout.writeAnsi(AsciiControl.enterAlternateScreen);
  try {
    // ... your app ...
  } finally {
    stdout.writeAnsi(AsciiControl.leaveAlternateScreen);
  }
}
</code></pre>
<h3 id="disable-non-standard-capture-when-shutting-down">Disable non-standard capture when shutting down</h3>
<p>There are many ways to signal to the terminal that you want to capture events
that are not normally emited, such as <code>EnableMouseCapture</code>, <code>CaptureFocus</code>,
<code>CapturePaste</code>, and so on.</p>
<p>When shutting down, disable these captures to avoid leaving the terminal in a
weird state:</p>
<pre class="language-dart"><code class="language-dart">import 'dart:io';
import 'package:mansion/mansion.dart';

void main() {
  try {
    stdout.writeAnsi(CursorVisibility.hide);
    stdout.writeAnsiAll(EnableMouseCapture.all);
    // ... your app ...
  } finally {
    stdout.writeAnsi(CursorVisibility.show);
    stdout.writeAnsiAll(DisableMouseCapture.all);
  }
}
</code></pre>
<h2 id="use-synchronousupdates-for-performance">Use <code>SynchronousUpdates</code> for performance</h2>
<p>When writing a lot of ANSI escape codes in a row, consider using
<code>SynchronousUpdates</code> to avoid flickering:</p>
<pre class="language-dart"><code class="language-dart">import 'dart:io';
import 'package:mansion/mansion.dart';

void main() {
  stdout.writeAnsiAll([
    SynchronousUpdates.start,
    // ... intermediate updates ...
    SynchronousUpdates.end,
  ]);
}
</code></pre>
<p>Or, even better, use the built-in <code>syncAnsiUpdate</code> extension on <code>StringSink</code>:</p>
<pre class="language-dart"><code class="language-dart">import 'dart:io';
import 'package:mansion/mansion.dart';

void main() async {
  stdout.syncAnsiUpdate((sink) {
    // Do anything here, and it will be written atomically.
  });

  // In a real application, you likely want to block on flushing as well.
  await stdout.flush();
}
</code></pre>
<p>For example, here is how you might structure a typical "game loop":</p>
<pre class="language-dart"><code class="language-dart">import 'dart:async';
import 'dart:io';
import 'package:mansion/mansion.dart';

void main() async {
  late final StreamSubscription&lt;void&gt; sigint;
  var running = true;
  try {
    sigint = ProcessSignal.sigint.watch().listen((_) {
      running = false;
    });
    final events = &lt;List&lt;int&gt;&gt;[];

    stdout.writeAnsi(AsciiControl.enterAlternateScreen);
    stdout.writeAnsi(CursorVisibility.hide);

    while (running) {
      // Process events.
      if (events.isNotEmpty) {
        final captured = events.toList();
        events.clear();
        for (final c in captured) {
          final e = Event.tryParse(c);
          // TODO: Handle the event.
        }
      }

      // Update the game state.
      // TODO: Implement this!

      // Render the game state.
      stdout.syncAnsiUpdate((sink) {
        // Clear the screen.
        sink.writeAnsi(Clear.all);

        // Draw the game state.
        // TODO: Implement this!
      }):

      await stdout.flush();
      await _wait16ms();
    }
  } finally {
    stdout.writeAnsi(CursorVisibility.show);
    stdout.writeAnsi(AsciiControl.leaveAlternateScreen);
    await sigint.cancel();
  }
}

Future&lt;void&gt; _wait16ms() =&gt; Future.delayed(const Duration(milliseconds: 16));
</code></pre>
<hr>
<div style="text-align: center">
<p><a href="Parsing%20ANSI%20Text-topic.html">â—„ Parsing ANSI Text</a></p>
</div>
</section>





  <section class="summary offset-anchor" id="extensions">
    <h2>Extensions</h2>

    <dl>
      <dt id="AnsiStringSink">
  <span class="name "><a href="../mansion/AnsiStringSink.html">AnsiStringSink</a></span>
  on W
  
    <span class="category introduction cp-0 linked" title="This is part of the Introduction topic."><a href="../topics/Introduction-topic.html">Introduction</a></span>
    <span class="category best-practices cp-6 linked" title="This is part of the Best Practices topic."><a href="../topics/Best Practices-topic.html">Best&nbsp;Practices</a></span>

</dt>
<dd>
  Provides extension methods for writing ANSI <a href="../mansion/Sequence-class.html">Sequence</a>s to a <code>StringSink</code>.
</dd>


    </dl>
  </section>




  <section class="summary offset-anchor" id="enums">
    <h2>Enums</h2>

    <dl>
      <dt id="AlternateScreen">
  <span class="name "><a href="../mansion/AlternateScreen.html">AlternateScreen</a></span> 
    <span class="category screen-manipulation cp-3 linked" title="This is part of the Screen Manipulation topic."><a href="../topics/Screen Manipulation-topic.html">Screen&nbsp;Manipulation</a></span>
    <span class="category best-practices cp-6 linked" title="This is part of the Best Practices topic."><a href="../topics/Best Practices-topic.html">Best&nbsp;Practices</a></span>

</dt>
<dd>
  An escape code that <a href="../mansion/AlternateScreen.html">enter</a>s or <a href="../mansion/AlternateScreen.html">leave</a>s the alternate screen buffer.
</dd>

      <dt id="SynchronousUpdates">
  <span class="name "><a href="../mansion/SynchronousUpdates.html">SynchronousUpdates</a></span> 
    <span class="category screen-manipulation cp-3 linked" title="This is part of the Screen Manipulation topic."><a href="../topics/Screen Manipulation-topic.html">Screen&nbsp;Manipulation</a></span>
    <span class="category best-practices cp-6 linked" title="This is part of the Best Practices topic."><a href="../topics/Best Practices-topic.html">Best&nbsp;Practices</a></span>

</dt>
<dd>
  An escape code that <a href="../mansion/SynchronousUpdates.html">start</a>s or <a href="../mansion/SynchronousUpdates.html">end</a>s synchronous updates.
</dd>

    </dl>
  </section>



</div> <!-- /.main-content -->

<div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
  <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>

<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="../index.html">mansion</a></li>
    <li class="self-crumb">Best Practices topic</li>
</ol>


  <h5><span class="package-name">mansion</span> <span class="package-kind">package</span></h5>
  <ol>
      <li class="section-title">Topics</li>
        <li><a href="../topics/Introduction-topic.html">Introduction</a></li>
        <li><a href="../topics/Styles and Colors-topic.html">Styles&nbsp;and&nbsp;Colors</a></li>
        <li><a href="../topics/Cursors and Positioning-topic.html">Cursors&nbsp;and&nbsp;Positioning</a></li>
        <li><a href="../topics/Screen Manipulation-topic.html">Screen&nbsp;Manipulation</a></li>
        <li><a href="../topics/Event Handling-topic.html">Event&nbsp;Handling</a></li>
        <li><a href="../topics/Parsing ANSI Text-topic.html">Parsing&nbsp;ANSI&nbsp;Text</a></li>
        <li><a href="../topics/Best Practices-topic.html">Best&nbsp;Practices</a></li>
      <li class="section-title">Libraries</li>
      <li><a href="../mansion/mansion-library.html">mansion</a></li>
</ol>

</div>

<div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  <h5>Best Practices topic</h5>
  <ol>


    <li class="section-title"><a href="../topics/Best Practices-topic.html#enums">Enums</a></li>
      <li><a href="../mansion/AlternateScreen.html">AlternateScreen</a></li>
      <li><a href="../mansion/SynchronousUpdates.html">SynchronousUpdates</a></li>








  <li class="section-title"><a href="../topics/Best Practices-topic.html#extensions">Extensions</a></li>
  <li><a href="../mansion/AnsiStringSink.html">AnsiStringSink</a></li>
</ol>

</div>
<!--/sidebar-offcanvas-right-->
</main>

<footer>
  <span class="no-break">
    mansion
      0.1.0
  </span>

  
</footer>



<script src="../static-assets/highlight.pack.js?v1"></script>
<script src="../static-assets/docs.dart.js"></script>



</body>

</html>

